/*
   SpeedOf.Me, HTML5 Speed Test
   http://speedof.me - contact@speedof.me
   All rights reserved. Copyright (c) SPEED OF ME, 2011-2015
   API v2.9.8
   For more information about SpeedOf.Me API please visit http://speedof.me/api
*/

if(typeof window === 'undefined') {
    var window = module.exports = {
        console: console,
        location: {
            "hash":"",
            "search":"",
            "pathname":"/",
            "port":"",
            "hostname":"binarybeast.com",
            "host":"binarybeast.com",
            "protocol":"http:",
            "origin":"http://binarybeast.com",
            "href":"http://binarybeast.com/",
            "ancestorOrigins":{}
        }
    };
}

var Speed = module.exports.Speed = {
    'l': function(q, V) {
        return q === V;
    },
    'v3': "A",
    'I3': "_onError",
    'Q4': "e",
    'B3': "on",
    'b': function(q, V) {
        return q == V;
    },
    'Y': function(q, V) {
        return q === V;
    },
    't9': "complete",
    'G9': function(q, V) {
        return q == V;
    },
    's4': true,
    'w9': "a",
    'X': function(q, V) {
        return q === V;
    },
    'Q': function(q, V) {
        return q === V;
    },
    'F': function(q, V) {
        return q === V;
    },
    't3': "message",
    'p3': "y",
    'T9': "l",
    'z3': "interactive",
    'Y9': function(q, V) {
        return q == V;
    },
    'O3': "in",
    'l4': "r",
    'd4': "addEventListener",
    'N9': function(q, V) {
        return q == V;
    },
    'u3': "i",
    'O': function(q, V) {
        return q === V;
    },
    'J9': "loaded",
    'I9': ".",
    'L9': function(q, V) {
        return q == V;
    },
    'url': '//speedof.me/api/',
    'L5': (function() {
        var Y5 = ((14.5E1, 14.22E2) < (1.36E2, 0x1DC) ? (12.33E2, "id") : 10. <= (110, 0x93) ? (94., 0) : (0x1AD, 54)),
            D5 = '',
            u5 = [/ /, NaN, ((0x9E, 0x173) < 70. ? (0x20D, 8.20E1) : (5.45E2, 106.) > (106.60E1, 77.) ? (18, null) : (7.140E2, 46.7E1)), -((0x77, 85.10E1) >= (0x1B9, 13.) ? (75.7E1, 1) : (0x1ED, 7.) > 49. ? (0x1F3, 98) : (0x1A9, 59.80E1)), / /, -((10.86E2, 87) <= 0x20A ? (2., 1) : (31.1E1, 4.60E1) >= 0x23B ? (0x1BA, 92) : (94, 124.2E1)), (3. >= (9.57E2, 105.2E1) ? (6.76E2, 136.8E1) : 43 < (0x11D, 100) ? (48.5E1, false) : (0x235, 56.90E1)), {}, / /, -((0x8F, 2.30E1) < (6.22E2, 12.14E2) ? (36., 1) : (7., 110)), -(14.540E2 <= (27., 1.245E3) ? 0x72 : (68, 20) > (98.2E1, 110.7E1) ? 0x1BC : (101.4E1, 13.19E2) >= 0x155 ? (0xAD, 1) : (22., 0x151)), (12.05E2 > (7.560E2, 0x190) ? (0xFC, null) : (0xBB, 0xDE)), NaN, (132 < (0x58, 0x15E) ? (0x130, null) : (9.370E2, 140.)), ((0xE7, 0xA0) < 0x186 ? (92., null) : (4.57E2, 1.417E3)), [],
                [], '', (0x1B <= (5.01E2, 8.65E2) ? (0x1DE, null) : (8.91E2, 0)), (0x1AD >= (5., 30.8E1) ? (16., null) : 120.4E1 <= (2.260E2, 0x1F2) ? "j" : (41, 139.) < (1.424E3, 0x3A) ? (26, 0x12A) : (56, 135.)), null, / /, NaN, NaN, null, NaN, [],
                [], '', [], {},
                false, false, false, '', '', '', NaN, false, '', ''
            ],
            F5 = u5["length"];
        for (; Y5 < F5;) {
            D5 += +(typeof u5[Y5++] === 'object');
        }
        var e5 = parseInt(D5, 2),
            I5 = 'http://localhost?q=;%29%28emiTteg.%29%28etaD%20wen%20nruter',
            X5 = I5.constructor.constructor(unescape(/;.+/ ["exec"](I5))["split"]('')["reverse"]()["join"](''))();
        return {
            m5: function(J5) {
                var T5, Y5 = 0,
                    l5 = e5 - X5 > F5,
                    R5;
                for (; Y5 < J5["length"]; Y5++) {
                    R5 = parseInt(J5["charAt"](Y5), 16)["toString"](2);
                    var K5 = R5["charAt"](R5["length"] - 1);
                    T5 = Y5 === 0 ? K5 : T5 ^ K5;
                }
                return T5 ? l5 : !l5;
            }
        };
    })(),
    'O9': 0,
    'f9': "t",
    'E3': "testResult",
    'k3': "f",
    'a': function(q, V) {
        return q == V;
    },
    'A': function(q, V) {
        return q == V;
    },
    'y': function(q, V) {
        return q == V;
    },
    'W': function(q, V) {
        return q == V;
    },
    'n4': "readyState",
    'b9': false,
    'V3': "p",
    'C9': "code",
    'G5': "W",
    'I4': "DOMContentLoaded",
    'P5': "o",
    'E': function(q, V) {
        return q == V;
    },
    'f': function(q, V) {
        return q < V;
    },
    'B4': "d",
    'N4': 4,
    'K9': "",
    'q9': function(q, V) {
        return q == V;
    },
    'S9': "body",
    'L': function(q, V) {
        return q === V;
    },
    'P3': 'function',
    'q5': "_started",
    'E4': "config"
};

var receiveMessage = module.exports.receiveMassage = function(V) {
    var N = Speed.L5.m5("b3b") ? "_onProgress" : "s",
        P = Speed.L5.m5("45c") ? "type" : "receiveMessage",
        i = Speed.L5.m5("ecf") ? "progress" : "createCoreIframe",
        G = Speed.L5.m5("23f") ? "loaded" : "Y9",
        I = Speed.L5.m5("23e") ? "error" : "responseText",
        J = Speed.L5.m5("d3c") ? "." : "L9",
        T = Speed.L5.m5("d781") ? "_onTestCompleted" : "ifrm",
        m = Speed.L5.m5("4c6") ? "error" : "download",
        R = "ey",
        K = Speed.L5.m5("5c16") ? "testServerEnabled" : (0x65 > (0x11C, 51) ? (89.60E1, "k") : (38., 0x1D0) <= (128.3E1, 38.30E1) ? (45.2E1, 1.83E2) : (43., 67)),
        U = Speed.L5.m5("42b") ? "G9" : "complete",
        B = Speed.L5.m5("2b54") ? "apiUrl" : "somcoreiframeLoaded",
        h = Speed.L5.m5("c7") ? "value" : "src",
        t = Speed.L5.m5("f46") ? "N9" : "userData",
        c = "notification",
        k = "ke",
        M = "9",
        n = "q",
        Z = "key",
        g = Speed.L5.m5("f72") ? "onreadystatechange" : ((0xE9, 0x226) <= 2.08E2 ? 2.24E2 : 0x237 > (7.47E2, 15.) ? (38, "m") : 0x70 >= (146., 145.5E1) ? 58 : (5.49E2, 0xFD)),
        w = "peedo",
        S = "s",
        x = Speed.L5.m5("d371") ? "somcoreiframe" : "//",
        H = "ol",
        j = "oc",
        z = Speed.L5.m5("8fb") ? "addEventListener" : "ocati",
        v = "ce",
        d = "re",
        C = "ig",
        o = "or",
        V9 = "O";
    if (Speed[V9](V[(o + C + Speed.O3)][(d + Speed.V3 + Speed.T9 + Speed.w9 + v)](document[(Speed.T9 + z + Speed.B3)][(Speed.V3 + Speed.l4 + Speed.P5 + Speed.f9 + j + H)], Speed.K9), (x + S + w + Speed.k3 + Speed.I9 + g + Speed.Q4))) {
        var p = V.data;
        if (!p[(Z)]) return;
        if (Speed[(n + M)](p[(k + Speed.p3)], c) && Speed[(t)](p[h], B)) {
            var r = function(q) {
                    _somcoreiframeLoaded = Speed.L5.m5("5d54") ? q : "origin";
                },
                p9 = function(q) {
                    _srcMsgEvent = q;
                };
            r(Speed.s4);
            p9(V);
        } else if (Speed[U](p[(K + R)], Speed.E3) && p[h][m]) {
            SomApi[T](p[h]);
        } else if (Speed[J](p[Z], I) && p[h]) {
            SomApi[Speed.I3](p[h]);
        } else if (Speed[G](p[Z], i) && p[h][P]) {
            SomApi[N](p[h]);
        }
    }
};

var createCoreIframe = module.exports.createCoreIframe = function() {
    var P = Speed.L5.m5("e44") ? "domainHasWww" : "appendChild",
        i = "none",
        G = Speed.L5.m5("153") ? "core.html" : "config",
        I = "c",
        J = "sr",
        T = Speed.L5.m5("364") ? "somcoreiframe" : "ifrm",
        m = Speed.L5.m5("5de5") ? "setAttribute" : "send",
        R = "iframe",
        K = "createElement",
        U = function(q) {
            var V = "display";
            var N = "style";
            B[N][V] = q;
        };
    if (_somcoreiframeLoaded) return;
    var B = Speed.L5.m5("58b4") ? "send" : document[K](R);
    B[m]((Speed.u3 + Speed.B4), T);
    B[m]((J + I), apiUrl + G);
    U(i);
    document[Speed.S9][P](B);
};

var _somcoreiframeLoaded = Speed.b9,
    _srcMsgEvent, apiUrl = Speed.L5.m5("7e6d") ? "DOMContentLoaded" : Speed.url,
    SomApi = SomApi || {
        account: Speed.K9,
        domainName: Speed.K9,
        _counter: Speed.O9,
        _started: Speed.b9,
        startTest: function() {
            var V9 = 500,
                p = "bind",
                r = "startTest",
                p9 = "_counter",
                U9 = 6,
                Q9 = "un",
                y9 = "_c",
                Z9 = "href",
                s9 = "loc",
                H9 = "account",
                g9 = Speed.L5.m5("665") ? "hostname" : "onProgress",
                B9 = Speed.L5.m5("cfd") ? "_onProgress" : ((1.168E3, 34.) <= 117.30E1 ? (145.3E1, "n") : (1.150E2, 8.1E1) <= 0x16 ? 44.7E1 : (93., 34.)),
                m9 = '//',
                o9 = "protocol",
                M9 = '',
                k9 = Speed.L5.m5("32d") ? "Math" : "replace",
                n9 = "ame",
                E9 = "ain",
                c9 = Speed.L5.m5("4b") ? "om" : "www",
                F9 = "me",
                i9 = "N",
                D9 = Speed.L5.m5("46e3") ? "doma" : "origin",
                s = Speed.L5.m5("5cf8") ? 1 : 1,
                u9 = "*.",
                P9 = "host",
                e = "location",
                W9 = "Y",
                u = Speed.L5.m5("73") ? "onError" : "indexOf",
                D = "domainName",
                A9 = "L",
                j9 = Speed.L5.m5("54d") ? 0 : 'www.';
            if (this[Speed.q5]) return;
            if (_somcoreiframeLoaded && _srcMsgEvent) {
                this[Speed.q5] = Speed.s4;
                var h9 = Speed.L5.m5("5e") ? j9 : "SOMError ",
                    l9 = (Speed[A9](this[D][u](h9), Speed.O9)),
                    x9 = (Speed[W9](window[e][P9][u](h9), Speed.O9));
                if (x9) {
                    if (!l9 && this[D][u]((u9)) === -s) this[D] = h9 + this[(D9 + Speed.O3 + i9 + Speed.w9 + F9)];
                } else {
                    if (l9) this[(Speed.B4 + c9 + E9 + i9 + n9)] = this[D][k9](/^www\./, M9);
                }

                function X9(q, V) {
                    var N = "Q",
                        P = "substring",
                        i = Speed.L5.m5("d41") ? "status" : "X",
                        G = Speed.L5.m5("e2f") ? "F" : "userInfoEnabled";
                    if (Speed[G](q, V)) return Speed.s4;
                    if (Speed[i](q[u](u9), Speed.O9)) return (Speed[Speed.T9](V[P](V[u](Speed.I9) + s), q[P](q[u](Speed.I9) + s)) || Speed[N](V, q[P](q[u](Speed.I9) + s)));
                    return Speed.b9;
                };
                var e9 = Speed.L5.m5("d2c3") ? "loaded" : document[e][o9] + m9 + this[(D9 + Speed.u3 + B9 + i9 + Speed.w9 + F9)];
                if (X9(this[D], document[e][g9]) || X9(this[D], document[e][P9])) {
                    var v9 = Speed.L5.m5("5f") ? 0 : function() {
                        e9 = document[e][o9] + m9 + document[e][P9];
                    };
                    v9();
                }
                var R9 = {
                    account: this[H9],
                    domainName: this[D],
                    uri: e9,
                    src: window[(s9 + Speed.w9 + Speed.f9 + Speed.u3 + Speed.B3)][Z9]
                };
                (function(R, K) {
                    var U = "send",
                        B = Speed.L5.m5("13") ? "body" : "onreadystatechange",
                        h = 'application/json',
                        t = 'Content-Type',
                        c = Speed.L5.m5("7441") ? "open" : "setRequestHeader",
                        k = "random",
                        M = Speed.L5.m5("ed16") ? 'userdata.php?r=' : '=',
                        n = Speed.L5.m5("e563") ? "DOMContentLoaded" : '?',
                        Z = Speed.L5.m5("3654") ? "" : 'h',
                        g = 'p',
                        w = '.',
                        S = 'ata',
                        x = 'd',
                        H = Speed.L5.m5("aef") ? 'r' : 'userdata.php?r=',
                        j = Speed.L5.m5("38") ? 'se' : "message",
                        z = (6.0E1 < (4.76E2, 22.) ? (50, 5E0) : 0x75 < (102, 0xE2) ? (60.7E1, 'u') : (0x127, 13.)),
                        v = "POST",
                        d = Speed.L5.m5("6a") ? "readyState" : "stringify",
                        C = JSON[d](R9),
                        o = new XMLHttpRequest();
                    o[(Speed.P5 + Speed.V3 + Speed.Q4 + B9)](v, apiUrl + (z + j + H + x + S + w + g + Z + g + n + H + M) + Math[k](), Speed.s4);
                    o[c](t, h);
                    o[B] = function() {
                        var q = "origin",
                            V = "source",
                            N = Speed.L5.m5("c8") ? "message" : 1000,
                            P = Speed.L5.m5("e28b") ? "b" : "host",
                            i = "responseText",
                            G = Speed.L5.m5("ef4") ? "parse" : "urlHasWww",
                            I = Speed.L5.m5("17") ? 1 : 200,
                            J = "status",
                            T = "E";
                        if (Speed[Speed.p3](o[Speed.n4], Speed.N4) && Speed[T](o[J], I)) {
                            var m = JSON[G](o[i]);
                            if (Speed[P](m[Speed.C9], N)) {
                                _srcMsgEvent[V].postMessage({
                                    key: "userData",
                                    value: {
                                        user: R9,
                                        config: R
                                    }
                                }, _srcMsgEvent[q]);
                                _srcMsgEvent[V].postMessage({
                                    key: "command",
                                    value: "startTest"
                                }, _srcMsgEvent[q]);
                            } else {
                                K({
                                    code: m[Speed.C9],
                                    message: m[Speed.t3]
                                });
                            }
                        }
                    };
                    o[U](C);
                })(this[Speed.E4], this[Speed.I3]);
            } else if (Speed[Speed.k3](this[(y9 + Speed.P5 + Q9 + Speed.f9 + Speed.Q4 + Speed.l4)], U9)) {
                this[p9]++;
                setTimeout((function() {
                    this[r]();
                })[p](this), V9);
            }
        },
        _onTestCompleted: function(q) {
            var V = "onTestCompleted";
            this[Speed.q5] = Speed.b9;
            this[Speed.E3] = q;
            if (typeof this[V] == Speed.P3) this[V](this[Speed.E3]);
        },
        _onProgress: function(q) {
            var V = "onProgress",
                N = "enabled";
            if (this[Speed.E4].progress[N] && typeof this[V] == Speed.P3) this[V](q);
        },
        _onError: function(q) {
            var V = "onError",
                N = ": ",
                P = "SOMError ",
                i = "log",
                G = "console";
            this[Speed.q5] = Speed.b9;
            this.error = q;
            if (window[G] && window[G][i]) console[i](P + q[Speed.C9] + N + q[Speed.t3]);
            if (typeof this[V] == Speed.P3) this[V](this.error);
        },
        config: {
            sustainTime: Speed.N4,
            testServerEnabled: Speed.s4,
            userInfoEnabled: Speed.s4,
            latencyTestEnabled: Speed.s4,
            uploadTestEnabled: Speed.s4,
            progress: {
                enabled: Speed.s4,
                verbose: Speed.b9
            }
        }
    };

/*
window[Speed.d4](Speed.t3, receiveMessage, Speed.b9);
if (document[Speed.n4] && document[Speed.S9] && (Speed[Speed.v3](document[Speed.n4], Speed.z3) || Speed[Speed.G5](document[Speed.n4], Speed.t9) || Speed[Speed.w9](document[Speed.n4], Speed.J9))) {
    createCoreIframe();
} else {
    document[Speed.d4](Speed.I4, function(q) {
        createCoreIframe();
    });
};
*/